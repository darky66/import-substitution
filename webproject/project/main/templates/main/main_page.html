{% extends "main/layout.html" %} {% block title %}–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞{% endblock %} {% block content %}

<header class="site-header">
    <div class="header-inner">
        <div class="logo">SoftGuide</div>
        <nav class="top-nav">
            <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="{% url 'favourites' %}" class="nav-link">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ ‚òÖ</a>
        </nav>
        <div class="burger">‚ò∞</div>
    </div>
</header>

<div class="container">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <h2 class="filters">–§–∏–ª—å—Ç—Ä—ã:</h2>

        <!-- Theme toggle -->
        <div class="theme-toggle-block">
            <span>–¢–µ–º–∞:</span>
            <button id="themeToggle" class="theme-toggle-btn" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
        </div>

        <div class="filter-group">
            <div class="filter-block">
                <div class="filter-title">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</div>
                <div class="chip-group">
                    <label><input type="radio" name="purpose" value="editor"><span>—Ä–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞</span></label>
                    <label><input type="radio" name="purpose" value="accounting"><span>–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è</span></label>
                    <label><input type="radio" name="purpose" value="chat"><span>–æ–±—â–µ–Ω–∏–µ</span></label>
                    <label><input type="radio" name="purpose" value="work"><span>—Ä–∞–±–æ—Ç–∞</span></label>
                    <label><input type="radio" name="purpose" value="fun"><span>—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</span></label>
                </div>
            </div>

            <div class="filter-block">
                <div class="filter-title">–¶–µ–Ω–∞:</div>
                <div class="chip-group">
                    <label><input type="radio" name="price" value="free"><span>–±–µ—Å–ø–ª–∞—Ç–Ω–æ</span></label>
                    <label><input type="radio" name="price" value="expensive"><span>–¥–æ—Ä–æ–≥–æ</span></label>
                </div>
            </div>

            <div class="filter-block">
                <div class="filter-title">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</div>
                <div class="chip-group">
                    <label><input type="radio" name="device" value="phone"><span>—Ç–µ–ª–µ—Ñ–æ–Ω</span></label>
                    <label><input type="radio" name="device" value="pc"><span>–ø–∫</span></label>
                </div>
            </div>

            <div class="filter-block">
                <div class="filter-title">–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:</div>
                <div class="chip-group">
                    <label><input type="radio" name="access" value="easy"><span>—Å–∫–∞—á–∞–ª –∏ –∑–∞–ø—É—Å—Ç–∏–ª</span></label>
                    <label><input type="radio" name="access" value="medium"><span>–Ω–∞–¥–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è</span></label>
                    <label><input type="radio" name="access" value="hard"><span>3 –≤—ã—Å—à–∏—Ö</span></label>
                </div>
            </div>
        </div>

        <a href="{% url 'favourites' %}" class="abort">
            <p class="star">‚òÖ</p> –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
    </aside>

    <!-- MAIN -->
    <main class="main">
        <form method="post">
            {% csrf_token %} {{ form.as_p }}
            <input class="search" name="name" type="text" placeholder="–ù–∞–π—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º—É...">
        </form>

        <h1>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</h1>

        {% for name, desc in items %} {% if name != '–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –º—ã –Ω–µ –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è' %}
        <div class="result-card">
            <button class="favorite-btn" aria-pressed="false" data-item-name="{{ name }}" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚òÜ</button>
            <div class="result-card-title">{{ name }}</div>
            <div class="result-card-desc">
                {% for i in desc %} {% if 'http' not in i and i != '-' %} {{ i }}<br> {% endif %} {% endfor %}
            </div>
            <div class="result-card-actions">
                {% for i in desc %} {% if 'http' in i %}
                <a href="{{ i }}" target="_blank" rel="noopener">–°–∫–∞—á–∞—Ç—å</a> {% endif %} {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="result-card">
            <div class="result-card-title">–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –º—ã –Ω–µ –º–æ–∂–µ–º –Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</div>
        </div>
        {% endif %} {% endfor %}
    </main>

    <!-- RECOMMENDATIONS -->
    <aside class="recommendations">
        <h2>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h2>
        <div class="rec-item">
            <a class="rec-text" href="https://max.ru/" target="_blank" rel="noopener"><img src="https://upload.wikimedia.org/wikipedia/commons/7/75/Max_logo_2025.png" class="rec-icon" alt="MAX"> - –º–µ—Å–µ–Ω–¥–∂–µ—Ä</a>
            <a class="rec-text" href="https://dzen.ru" target="_blank" rel="noopener"><img src="https://upload.wikimedia.org/wikipedia/commons/5/58/Yandex_icon.svg" class="rec-icon" alt="Yandex"> - –ø–æ–∏—Å–∫–æ–≤–∏–∫</a>
            <a class="rec-text" href="https://elma365.com/ru/" target="_blank" rel="noopener"><img src="https://softline.ru/upload/iblock/276/qldcbie6vmyo7mtnsqr74j95rpxl97nn/elma_color_1024.png" class="rec-icon" alt="ELMA"> - –¥–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç</a>
            <a class="rec-text" href="https://1c.ru/" target="_blank" rel="noopener"><img src="https://upload.wikimedia.org/wikipedia/commons/9/93/1C_Company_logo.svg" class="rec-icon" alt="1C"> - –≤—Å–µ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π</a>
            <a class="rec-text" href="https://www.kaspersky.ru/" target="_blank" rel="noopener"><img src="https://upload.wikimedia.org/wikipedia/commons/2/25/Kaspersky_logo.svg" class="rec-icon" alt="Kaspersky"> - –∞–Ω—Ç–∏–≤–∏—Ä—É—Å</a>
            <a class="rec-text" href="https://rosa.ru/r7-office/" target="_blank" rel="noopener"><img src="https://www.irisoft.ru/wp-content/uploads/2022/09/r7o.png" class="rec-icon" alt="R7 Office"> - —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä</a>
        </div>
    </aside>
</div>

<footer class="site-footer">
    <div class="footer-inner">
        <div class="footer-copy">¬© 2025 SoftGuide ‚Äî –ø–æ–¥–±–æ—Ä –ø—Ä–æ–≥—Ä–∞–º–º</div>
        <div class="footer-links">
            <a href="#" class="footer-link">–û –ø—Ä–æ–µ–∫—Ç–µ</a>
            <a href="#" class="footer-link">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a>
        </div>
    </div>
</footer>

<script>
    // === Theme toggle ===
    (function() {
        const root = document.documentElement;
        const btn = document.getElementById("themeToggle");

        const saved = localStorage.getItem("theme") || "dark";
        root.setAttribute("data-theme", saved);
        if (btn) btn.textContent = saved === "light" ? "‚òÄÔ∏è" : "üåô";

        if (btn) {
            btn.addEventListener("click", () => {
                const current = root.getAttribute("data-theme");
                const next = current === "light" ? "dark" : "light";
                root.setAttribute("data-theme", next);
                localStorage.setItem("theme", next);
                btn.textContent = next === "light" ? "‚òÄÔ∏è" : "üåô";
            });
        }
    })();

    // === Sticky header on scroll ===
    window.addEventListener("scroll", () => {
        const header = document.querySelector('.site-header');
        if (!header) return;
        if (window.scrollY > 20) header.classList.add('scrolled');
        else header.classList.remove('scrolled');
    });

    // === Mobile burger menu ===
    (function() {
        const burger = document.querySelector('.burger');
        const nav = document.querySelector('.top-nav');
        if (!burger || !nav) return;

        burger.addEventListener('click', () => {
            nav.classList.toggle('active');
            burger.classList.toggle('active');
        });
    })();

    // === Favorites (localStorage) ===
    (function() {
        const storageKey = 'favoritesDictionary';

        function loadFavorites() {
            try {
                const saved = localStorage.getItem(storageKey);
                if (saved) return JSON.parse(saved) || {};
            } catch (e) {
                console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', e);
            }
            return {};
        }

        function saveFavorites(dict) {
            try {
                localStorage.setItem(storageKey, JSON.stringify(dict));
            } catch (e) {
                console.warn('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ:', e);
            }
        }

        let favoritesDictionary = loadFavorites();
        if (!favoritesDictionary || Array.isArray(favoritesDictionary)) favoritesDictionary = {};

        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–º–µ—Ç–∏–º —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ
        document.addEventListener('DOMContentLoaded', function() {
            Object.keys(favoritesDictionary).forEach(item => {
                const btn = document.querySelector(`[data-item-name="${item}"]`);
                if (btn) {
                    btn.setAttribute('aria-pressed', 'true');
                    btn.classList.add('active');
                    btn.textContent = '‚òÖ';
                }
            });
        });

        function toggleFavorite(btn) {
            if (!btn) return;
            const itemname = btn.getAttribute('data-item-name');
            const isPressed = btn.getAttribute('aria-pressed') === 'true';

            if (isPressed) {
                delete favoritesDictionary[itemname];
                btn.setAttribute('aria-pressed', 'false');
                btn.classList.remove('active');
                btn.textContent = '‚òÜ';
            } else {
                favoritesDictionary[itemname] = 1;
                btn.setAttribute('aria-pressed', 'true');
                btn.classList.add('active');
                btn.textContent = '‚òÖ';
            }
            saveFavorites(favoritesDictionary);
        }

        // –î–µ–ª–µ–≥–∏—Ä—É–µ–º –∫–ª–∏–∫
        document.addEventListener('click', function(e) {
            const fav = e.target.closest('.favorite-btn');
            if (fav) {
                toggleFavorite(fav);
            }
        });
    })();
</script>

{% endblock %}