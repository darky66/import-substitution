{% extends "main/layout.html" %} {% block title %} Главная страница {% endblock %} {% block content %}
<div class="container">
    <aside class="sidebar">
        <h2 class="filters">Фильтры:</h2>
        <div class="filter-group">
            <div class="filter-block">
                <div class="filter-title">Назначение:</div>
                <label><input type="radio" name="purpose"> редактор текста</label>
                <label><input type="radio" name="purpose"> бухгалтерия</label>
                <label><input type="radio" name="purpose"> общение</label>
                <label><input type="radio" name="purpose"> работа</label>
                <label><input type="radio" name="purpose"> развлечения</label>
            </div>
            <div class="filter-block">
                <div class="filter-title">Цена:</div>
                <label><input type="radio" name="price"> бесплатно</label>
                <label><input type="radio" name="price"> дорого</label>
            </div>
            <div class="filter-block">
                <div class="filter-title">Устройство:</div>
                <label><input type="radio" name="device"> телефон</label>
                <label><input type="radio" name="device"> пк</label>
            </div>
            <div class="filter-block">
                <div class="filter-title">Доступность:</div>
                <label><input type="radio" name="access"> скачал и запустил</label>
                <label><input type="radio" name="access"> надо разобраться</label>
                <label><input type="radio" name="access"> 3 высших</label>
            </div>
        </div>
    </aside>
    <main class="main">
        <form method="post">
            {% csrf_token %} {{ form.as_p }}
            <input class="search" name='name' type="text" placeholder="Найти программу...">
            <!--  !!!   -->
        </form>
        <h1>Результаты поиска:</h1>
        {% for i in result %}
        <div class="alert alert-warning">
            {% if i != 'К сожалению, мы не можем найти похожие приложения' %}
                <h2 class="output"><button class="favorite-btn" aria-pressed="false" data-item-name = {{i}} aria-label="Добавить в избранное"></button>{{i}}</h2>
            {% endif %}  
            {% if i == 'К сожалению, мы не можем найти похожие приложения' %}
                <h2 class="output">{{i}}</h2>
            {% endif %}
        </div>
        {% endfor%}
    </main>
    <aside class="recommendations">
        <h2>Рекомендации:</h2>
        <div class="rec-item">
            <img src="https://upload.wikimedia.org/wikipedia/commons/7/75/Max_logo_2025.png" alt="Поиск" class="rec-icon">
            <span>- лучший отечественный месенджер</span>
        </div>
    </aside>
    <script>
        (function() {
            const storageKey = 'favoritesDictionary';
            function loadFavorites() {
                try {
                    const saved = localStorage.getItem(storageKey);
                    return saved ? JSON.parse(saved) : [];
                } catch (e) {
                    console.error('Ошибка загрузки избранного:', e);
                    return [];
                }
            }
            
            function saveFavorites(dict) {
                try {
                    localStorage.setItem(storageKey, JSON.stringify(dict));
                } catch (e) {
                    console.error('Ошибка сохранения избранного:', e);
                }
            }
            
            // Загружаем сохраненные избранные при запуске
            const favoritesDictionary = loadFavorites();
            
            // Восстанавливаем состояние кнопок при загрузке страницы
            document.addEventListener('DOMContentLoaded', function() {
                Object.values(favoritesDictionary).forEach(item => {
                    const btn = document.querySelector(`[data-item-name="${item.id}"]`);
                    if (btn) {
                        btn.setAttribute('aria-pressed', 'true');
                        btn.classList.add('active');
                    }
                });
                console.log('Восстановлены избранные:', favoritesDictionary);
            });
            function toggleFavorite(btn) {
                const pressed = btn.getAttribute('aria-pressed') === 'true';
                const newState = !pressed;
                const itemname = btn.getAttribute('data-item-name') || 'default';
                
                btn.setAttribute('aria-pressed', String(newState));
                btn.classList.toggle('active', newState);
                
                if (newState) {
                    favoritesDictionary[itemname] = 1
                } else {
                    if (favoritesDictionary[itemname]) {
                        delete favoritesDictionary[itemname];
                    }
                }
                saveFavorites(favoritesDictionary);
                console.log('Текущие избранные:', favoritesDictionary);
            }
            document.addEventListener('click', function(e) {
                const btn = e.target.closest && e.target.closest('.favorite-btn');
                if (!btn) return;
                toggleFavorite(btn);
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === ' ' || e.key === 'Enter') {
                    const active = document.activeElement;
                    if (active && active.classList && active.classList.contains('favorite-btn')) {
                        e.preventDefault();
                        toggleFavorite(active);
                    }
                }
            });
            
            window.getFavorites = function() {
                return [...favoritesDictionary];
            };
            /* for (const key in favoritesDictionary) {  
                delete favoritesDictionary[key];  
            } */
    })();
    </script>
</div>


{% endblock %}