{% extends "main/layout.html" %} {% block title %} Главная страница {% endblock %} {% block content %}
<div class="container">
    <aside class="sidebar">
        <h2 class="filters">Фильтры:</h2>
        <div class="filter-group">
            <div class="filter-block">
                <div class="filter-title">Назначение:</div>
                <label><input type="radio" name="purpose"> редактор текста</label>
                <label><input type="radio" name="purpose"> бухгалтерия</label>
                <label><input type="radio" name="purpose"> общение</label>
                <label><input type="radio" name="purpose"> работа</label>
                <label><input type="radio" name="purpose"> развлечения</label>
            </div>
            <div class="filter-block">
                <div class="filter-title">Цена:</div>
                <label><input type="radio" name="price"> бесплатно</label>
                <label><input type="radio" name="price"> дорого</label>
            </div>
            <div class="filter-block">
                <div class="filter-title">Устройство:</div>
                <label><input type="radio" name="device"> телефон</label>
                <label><input type="radio" name="device"> пк</label>
            </div>
            <div class="filter-block">
                <div class="filter-title">Доступность:</div>
                <label><input type="radio" name="access"> скачал и запустил</label>
                <label><input type="radio" name="access"> надо разобраться</label>
                <label><input type="radio" name="access"> 3 высших</label>
            </div>
        </div>
        <a href="{% url 'favourites' %}" class="abort">
            <p class="star">★</p> Избранное</a>
    </aside>
    <main class="main">
        <form method="post">
            {% csrf_token %} {{ form.as_p }}
            <input class="search" name='name' type="text" placeholder="Найти программу...">
        </form>
        <h1>Результаты поиска:</h1>
        {% for name, desc in items %}
        <div class="alert alert-warning">
            {% if name != 'К сожалению, мы не можем найти похожие приложения' %}
            <h2 class="output"><button class="favorite-btn" aria-pressed="false" data-item-name={ { name }} aria-label="Добавить в избранное"></button>{{ name }} {% for i in desc %} {% if 'http' not in i and i != '-'%}
                <br>{{ i }} {% endif %} {% if 'http' in i%}
                <br>Ссылка на скачивание: <a href={ { i }}> {{ i }}</a> {% endif %} {% if i == '-'%}
                <br>Ссылка на скачивание: {{ i }} {% endif %} {% endfor %}</h2>
            {% endif %} {% if name == 'К сожалению, мы не можем найти похожие приложения' %}
            <h2 class="output">{{ 'К сожалению, мы не можем найти похожие приложения' }}</h2>
            {% endif %}
        </div>
        {% endfor%}
    </main>
    <aside class="recommendations">
        <h2>Рекомендации:</h2>
        <div class="rec-item">
            <a class="rec-text" href="https://max.ru/" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/7/75/Max_logo_2025.png" alt="MAX" class="rec-icon"> - месенджер</a>
            <a class="rec-text" href="https://dzen.ru" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/5/58/Yandex_icon.svg" alt="Яндекс" class="rec-icon"> - поисковик</a>
            <a class="rec-text" href="https://elma365.com/ru/" target="_blank"><img src="https://softline.ru/upload/iblock/276/qldcbie6vmyo7mtnsqr74j95rpxl97nn/elma_color_1024.png" alt="VK" class="rec-icon"> - документооборот</a>
            <a class="rec-text" href="https://1c.ru/" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/9/93/1C_Company_logo.svg" alt="Поиск" class="rec-icon"> - все для предпринимателей</a>
            <a class="rec-text" href="https://www.kaspersky.ru/" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/2/25/Kaspersky_logo.svg" alt="Поиск" class="rec-icon"> - антивирус</a>
            <a class="rec-text" href="https://rosa.ru/r7-office/" target="_blank"><img src="https://www.irisoft.ru/wp-content/uploads/2022/09/r7o.png" alt="Поиск" class="rec-icon"> - текстовый редактор</a>
        </div>
    </aside>
    <script>
        (function() {
            const storageKey = 'favoritesDictionary';

            function loadFavorites() {
                try {
                    const saved = localStorage.getItem(storageKey);
                    if (saved) {
                        const parsed = JSON.parse(saved);
                        return parsed && typeof parsed === 'object' ? parsed : {};
                    }
                } catch (e) {
                    console.error('Ошибка загрузки:', e);
                }
                return {};
            }

            function saveFavorites(dict) {
                //if (dict && typeof dict === 'object') {
                localStorage.setItem(storageKey, JSON.stringify(dict));
                //}
            }

            let favoritesDictionary = loadFavorites();
            if (!favoritesDictionary || Array.isArray(favoritesDictionary)) {
                favoritesDictionary = {};
            }

            console.log('Initial state:', favoritesDictionary);

            document.addEventListener('DOMContentLoaded', function() {
                Object.keys(favoritesDictionary).forEach(item => {
                    const btn = document.querySelector(`[data-item-name="${item}"]`);
                    if (btn) {
                        btn.setAttribute('aria-pressed', 'true');
                        btn.classList.add('active');
                    }
                });
            });

            function toggleFavorite(btn) {
                const itemname = btn.getAttribute('data-item-name');
                const isPressed = btn.getAttribute('aria-pressed') === 'true';

                if (isPressed) {
                    delete favoritesDictionary[itemname];
                    btn.setAttribute('aria-pressed', 'false');
                    btn.classList.remove('active');
                } else {
                    favoritesDictionary[itemname] = 1;
                    btn.setAttribute('aria-pressed', 'true');
                    btn.classList.add('active');
                }
                console.log(favoritesDictionary)
                saveFavorites(favoritesDictionary);
            }

            function clearFavorites() {
                Object.keys(favoritesDictionary).forEach(key => {
                    delete favoritesDictionary[key];
                });
                localStorage.removeItem('favoritesDictionary');
                document.querySelectorAll('.favorite-btn[aria-pressed="true"]').forEach(btn => {
                    btn.setAttribute('aria-pressed', 'false');
                    btn.classList.remove('active');
                });

                console.log('Все избранные очищены');
                return true;
            }

            document.addEventListener('click', function(e) {
                if (e.target.closest('.favorite-btn')) {
                    toggleFavorite(e.target.closest('.favorite-btn'));
                }
            });
        })();
    </script>
</div>


{% endblock %}